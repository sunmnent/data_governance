(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[9],{"/iXv":function(e,t,a){"use strict";var l=a("g09b");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=l(a("Mosh")),n=r.default.generateActions({left_right_reset_sourceTableAndSourceTableColumns:"left_right_refresh_sourceTableAndSourceTableColumns",left_right_add_sourceTableAndSourceTableColumns:"left_right_add_sourceTableAndSourceTableColumns",left_right_refresh_sourceTableAndSourceTableColumns:"left_right_refresh_sourceTableAndSourceTableColumns"});t.default=n},"18GJ":function(e,t,a){"use strict";var l=a("tAuX"),r=a("g09b");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("2qtc");var n=r(a("kLXV"));a("Pwec");var s=r(a("CtXQ"));a("miYZ");var u=r(a("tsqr")),o=r(a("gWZ8")),d=r(a("2Taf")),c=r(a("vZ4D")),i=r(a("l4Ni")),f=r(a("ujKo")),m=r(a("rlhR")),g=r(a("MhPg"));a("OaEy");var h=r(a("2fM7")),p=l(a("q1tI")),v=r(a("oLOj")),b=h.default.Option,T=function(e){function t(){var e,a;(0,d.default)(this,t);for(var l=arguments.length,r=new Array(l),n=0;n<l;n++)r[n]=arguments[n];return a=(0,i.default)(this,(e=(0,f.default)(t)).call.apply(e,[this].concat(r))),a.state={data:[]},a.generateRelationship=function(e,t){return p.default.createElement(h.default,{size:"small",style:{width:"100%"},value:a.state.data[e][t],onChange:a.changeValue.bind((0,m.default)(a),e,t)},p.default.createElement(b,{value:1},"\u5de6\u8fde\u63a5"),p.default.createElement(b,{value:2},"\u5185\u8fde\u63a5"),p.default.createElement(b,{value:3},"\u53f3\u8fde\u63a5"),p.default.createElement(b,{value:4},"\u5168\u8fde\u63a5"))},a.generatePrimaryTable=function(e,t){return p.default.createElement(h.default,{size:"small",style:{width:"100%"},value:a.state.data[e][t],onChange:a.changeValue.bind((0,m.default)(a),e,t)},Object.keys(a.props.fieldObj).map(function(e){return p.default.createElement(b,{value:e,key:e},e)}))},a.generatePrimaryField=function(e,t,l){var r=a.props.fieldObj[a.state.data[e][l]],n=r?r.columnsList:[];return p.default.createElement(h.default,{size:"small",style:{width:"100%"},value:a.state.data[e][t],onChange:a.changeValue.bind((0,m.default)(a),e,t)},n.map(function(e){return p.default.createElement(b,{value:e.name,key:e.name},e.name)}))},a.getAssociations=function(e){var t=a.state.data.slice(0,e).reduce(function(e,t){return t.rightTabName&&!e.includes(t.rightTabName)?[].concat((0,o.default)(e),[t.rightTabName]):e},[]);return t},a.generateAssociationTable=function(e,t){return p.default.createElement(h.default,{size:"small",style:{width:"100%"},value:a.state.data[e][t],onChange:a.changeValue.bind((0,m.default)(a),e,t)},a.getAssociations(e).map(function(e){return p.default.createElement(b,{value:e,key:e},e)}))},a.changeValue=function(e,t,l){var r=(0,o.default)(a.state.data),n=r[e][t];r[e][t]=l,"rightTabName"===t&&(r[e].rightField=void 0,a.verifyLeftTabName(e+1,n)),"leftTabName"===t&&(r[e].leftField=void 0),a.setState({data:r})},a.addData=function(e){var t=(0,o.default)(a.state.data);t.splice(e,0,{}),a.setState({data:t})},a.removeData=function(e){var t=(0,o.default)(a.state.data),l=t[e].rightTabName;t.splice(e,1),a.setState({data:t},function(){a.verifyLeftTabName(e,l)})},a.submit=function(){var e=a.state.data.slice(1),t=!0,l=!1,r=void 0;try{for(var n,s=e[Symbol.iterator]();!(t=(n=s.next()).done);t=!0){var o=n.value;if(Object.values(o).filter(function(e){return!!e}).length<5)return void u.default.warn("\u8bf7\u628a\u6570\u636e\u586b\u5199\u5b8c\u6574")}}catch(e){l=!0,r=e}finally{try{t||null==s.return||s.return()}finally{if(l)throw r}}a.props.submit(e)},a.verifyLeftTabName=function(e,t){for(var l=(0,o.default)(a.state.data),r=l.length,n=e;n<r;n++){if(l[n].leftTabName!==t)break;var s=a.getAssociations(n);s.includes(t)||(l[n].leftTabName=void 0,l[n].leftField=void 0)}a.setState({data:l})},a}return(0,g.default)(t,e),(0,c.default)(t,[{key:"componentDidUpdate",value:function(e,t){e.visible!==this.props.visible&&this.props.visible&&!this.state.data.length&&(this.props.data&&0!==this.props.data.length||this.setState({data:[{},{}]}))}},{key:"render",value:function(){var e=this,t=this.props,a=t.visible,l=(t.fieldObj,this.state.data);return p.default.createElement(n.default,{title:"\u5173\u8054\u5173\u7cfb",width:1e3,visible:a,onOk:this.submit,onCancel:this.props.close},l[0]&&p.default.createElement(p.Fragment,null,p.default.createElement("div",{className:v.default.flex},p.default.createElement("div",{className:v.default.relationship}),p.default.createElement("div",{className:v.default.select},"\u4e3b\u8868"),p.default.createElement("div",{className:v.default.alias},"\u522b\u540d")),p.default.createElement("div",{className:"".concat(v.default.flex," ").concat(v.default.primaryTable)},p.default.createElement("div",{className:v.default.relationship}),p.default.createElement("div",{className:v.default.select},this.generatePrimaryTable(0,"rightTabName")),p.default.createElement("div",{className:v.default.alias},"tb_1"))),p.default.createElement("div",{className:v.default.flex},p.default.createElement("div",{className:v.default.relationship},"\u5173\u8054\u5173\u7cfb"),p.default.createElement("div",{className:v.default.select},"\u4ece\u8868"),p.default.createElement("div",{className:v.default.alias},"\u522b\u540d"),p.default.createElement("div",{className:v.default.select},"\u4ece\u8868\u5b57\u6bb5"),p.default.createElement("div",{className:v.default.select},"\u5173\u8054\u8868"),p.default.createElement("div",{className:v.default.select},"\u5173\u8054\u5b57\u6bb5"),p.default.createElement("div",{className:v.default.condition},"\u6761\u4ef6")),l.slice(1).map(function(t,a){return p.default.createElement("div",{className:v.default.flex,key:a},p.default.createElement("div",{className:v.default.relationship},e.generateRelationship(a+1,"joinRelation")),p.default.createElement("div",{className:v.default.select},e.generatePrimaryTable(a+1,"rightTabName")),p.default.createElement("div",{className:v.default.alias},"tb_",a+2),p.default.createElement("div",{className:v.default.select},e.generatePrimaryField(a+1,"rightField","rightTabName")),p.default.createElement("div",{className:v.default.select},e.generateAssociationTable(a+1,"leftTabName")),p.default.createElement("div",{className:v.default.select},e.generatePrimaryField(a+1,"leftField","leftTabName")),p.default.createElement("div",{className:v.default.condition}),p.default.createElement("div",null,p.default.createElement(s.default,{type:"plus-circle",onClick:e.addData.bind(e,a+2),className:"can-click",style:{marginRight:10}}),l.length>2&&p.default.createElement(s.default,{type:"minus-circle",onClick:e.removeData.bind(e,a+1),className:"can-click"})))}))}}]),t}(p.Component),_=T;t.default=_},"4eGu":function(e,t,a){"use strict";var l=a("tAuX"),r=a("g09b");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("14J3");var n=r(a("BMrR"));a("jCWc");var s=r(a("kPKH"));a("Pwec");var u=r(a("CtXQ")),o=r(a("p0pE")),d=r(a("2Taf")),c=r(a("vZ4D")),i=r(a("l4Ni")),f=r(a("ujKo")),m=r(a("MhPg"));a("OaEy");var g=r(a("2fM7")),h=l(a("q1tI")),p=r(a("LvDl")),v=r(a("Mosh")),b=a("E5h/"),T=r(a("/iXv")),_=a("7z+u"),N=g.default.Option,E=function(e){function t(e){var a;return(0,d.default)(this,t),a=(0,i.default)(this,(0,f.default)(t).call(this,e)),a.generateDataSourceOptions=function(){var e=a.props.sourceName;return(0,_.querySourceDataSource)({sourceName:e}).then(function(e){var t={},l=v.default.setDefaults(p.default.get(e,"obj"),{}),r=p.default.map(l,function(e){var a=e.id,l=e.sourceName;return a+="",t[a]=e,h.default.createElement(N,{id:a,key:a},l)});a.setState({dataSourceOptions:r,dataSourceIdMap:t}),a.state.dataSourceId||a.setState({dataSourceId:e.obj[0].id})})},a.dataSourceChange=function(e){a.setState({dataSourceId:e,sourceTableOptions:[],sourceTableMap:{},selected_sourceTables:[]},function(){a.generateSourceTableOptions().then(function(){(0,b.emit)(T.default.left_right_reset_sourceTableAndSourceTableColumns,(0,o.default)({},p.default.pick(a.state,["dataSourceId","selected_sourceTables"])))})})},a.generateSourceTableOptions=function(){var e=a.state.dataSourceId;if(v.default.notNull(e))return(0,_.getTablesAndColumnsInfo)({datasourceId:e}).then(function(e){var t={},l=v.default.setDefaults(p.default.get(e,"obj"),[]),r=p.default.map(l,function(e){var a=e.sourceId,l=e.tableName,r=e.tableNameCn,n=e.columnsList;return t[l]={__$$columnsList$$__:[]},n&&n.length&&p.default.map(n,function(e){var a=e.name;t[l][a]=e,t[l]["__$$columnsList$$__"].push({sourceFieldName:a})}),h.default.createElement(N,{"data-sourceid":a,key:l},l,r?"--".concat(r):"")});a.setState({sourceTableOptions:r,sourceTableMap:t})})},a.sourceTableChange=function(e,t){var l=p.default.get(t,"props.data-sourceid","");if(a.setState(function(t){var a=t.selected_sourceTables;return a.push({sourceId:l,sourceTableName:e}),a=p.default.uniqWith(a,function(e,t){return e.sourceTableName===t.sourceTableName}),{selected_sourceTables:a}},function(){var e=a.state,t=e.dataSourceId,l=e.selected_sourceTables,r=p.default.get(p.default.last(l),"sourceTableName");(0,b.emit)(T.default.left_right_add_sourceTableAndSourceTableColumns,(0,o.default)({},p.default.pick(a.state,["sourceTableMap","selected_sourceTables"]),{dataSourceId:t,tableName:r}))}),"1"===localStorage.getItem("TRANSLATE")&&"\u6807\u51c6\u5e93"===a.props.sourceName){var r=a.state,n=r.dataSourceIdMap,s=r.dataSourceId;(0,_.getDataItemRelation)({sourceCode:n[s].sourceCode,tableName:e}).then(function(e){e&&e.success&&a.props.changeDataItemRelation(e.obj||{})})}},a.deleteSelectedSourceTables=function(e,t){var l;a.setState(function(e){var a=e.selected_sourceTables;return l=a.splice(t,1)[0],{selected_sourceTables:a}},function(){(0,b.emit)(T.default.left_right_refresh_sourceTableAndSourceTableColumns,(0,o.default)({},p.default.pick(a.state,["sourceTableMap","selected_sourceTables"]),{deletedSourceTable:l}))})},a.state={dataSourceId:void 0,dataSourceOptions:[],dataSourceIdMap:{},sourceTableOptions:[],sourceTableMap:{},selected_sourceTables:[]},a}return(0,m.default)(t,e),(0,c.default)(t,[{key:"componentDidUpdate",value:function(e,t){var a=this;this.props.ID!==e.ID&&this.generateDataSourceOptions().then(this.generateSourceTableOptions).then(function(){(0,b.emit)(T.default.left_right_refresh_sourceTableAndSourceTableColumns,(0,o.default)({},p.default.pick(a.state,["dataSourceId","sourceTableMap","selected_sourceTables"])));var e=a.state,t=e.dataSourceId,l=e.selected_sourceTables;l.forEach(function(e){(0,b.emit)(T.default.left_right_add_sourceTableAndSourceTableColumns,(0,o.default)({},p.default.pick(a.state,["sourceTableMap","selected_sourceTables"]),{dataSourceId:t,tableName:e.sourceTableName}))})})}},{key:"render",value:function(){var e=this,t=this.state,a=t.dataSourceId,l=t.dataSourceOptions,r=t.dataSourceIdMap,o=t.sourceTableOptions,d=t.selected_sourceTables,c=p.default.get(p.default.last(d),"sourceTableName");a=r[a]?a+"":void 0;var i=this.props.style,f=void 0===i?{}:i;return f=p.default.assign(f,{flexBasis:"350px"}),h.default.createElement("div",{className:"shrink0 padding20 bg-white",style:f},h.default.createElement("div",{className:"p-h20 m-bottom10"},h.default.createElement("strong",{className:"block m-bottom10"},"\u6570\u636e\u6e90"),h.default.createElement(g.default,{placeholder:"--\u8bf7\u9009\u62e9\u6570\u636e\u6e90--",showSearch:!0,optionFilterProp:"children",value:a,onChange:this.dataSourceChange,className:"w-p100"},l)),h.default.createElement("div",{className:"p-h20 m-bottom10"},h.default.createElement("strong",{className:"block m-bottom10"},"\u6e90\u8868"),h.default.createElement(g.default,{placeholder:"--\u8bf7\u9009\u62e9\u8868--",showSearch:!0,value:c,onChange:this.sourceTableChange,className:"w-p100"},o)),h.default.createElement("div",{className:"p-h20 m-bottom10"},p.default.map(d,function(t,a){var l=t.sourceTableName;return h.default.createElement(n.default,{key:l,className:"p-v5 ani-hover us-none",style:{borderBottom:"1px dashed #D9D9D9"}},h.default.createElement(s.default,{span:2,className:"text-center"},h.default.createElement(u.default,{type:"table",style:{color:"#5172a5",padding:"0 5px"}})),h.default.createElement(s.default,{span:20,className:"ellipsis"},l),h.default.createElement(s.default,{span:2,className:"text-center"},h.default.createElement(u.default,{type:"close",onClick:function(){return e.deleteSelectedSourceTables(t,a)},className:"cs-pointer"})))})))}}],[{key:"getDerivedStateFromProps",value:function(e,t){return e.ID!==t.ID?e:null}}]),t}(h.Component);t.default=E},Amfe:function(e,t,a){"use strict";var l=a("g09b");Object.defineProperty(t,"__esModule",{value:!0}),t.findTargetTab=n,t.findSourceTab=s,t.saveOrUpdate=u;var r=l(a("t3Un"));function n(e){return(0,r.default)("/dataIntegrate/findTargetTab",{method:"GET"})}function s(e){return(0,r.default)("/dataIntegrate/findSourceTab",{method:"GET"})}function u(e){return(0,r.default)("/dataIntegrate/saveOrUpdate",{method:"post",data:e})}},"FGv/":function(e,t,a){},PIGj:function(e,t,a){"use strict";var l=a("g09b"),r=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=l(a("jehZ"));a("+L6B");var s,u,o,d=l(a("2/Rp")),c=l(a("p0pE")),i=l(a("2Taf")),f=l(a("vZ4D")),m=l(a("l4Ni")),g=l(a("ujKo")),h=l(a("MhPg")),p=r(a("q1tI")),v=l(a("LvDl")),b=l(a("Mosh")),T=a("ieSl"),_=a("MuoO"),N=a("7DNP"),E=l(a("Qyje")),I=l(a("lFrO")),y=l(a("4eGu"));a("FGv/");var C=b.default.generateUpdateIds(2),S=(s=(0,_.connect)(),s((o=function(e){function t(e){var a;return(0,i.default)(this,t),a=(0,m.default)(this,(0,g.default)(t).call(this,e)),a.getEchoData=function(e){(0,T.getInfoHuixian)({id:e}).then(function(t){var l=b.default.setDefaults(v.default.get(t,"obj"),{}),r=a.handleEchoData(l),n=l.dataIntegrate.remark,s=l.dataIntegrate.config,u=l.dataIntegrate.priority,o=l.dataIntegrate.isIncrement,d=l.dataIntegrate.condition,i=l.dataIntegrate.type;a.setState((0,c.default)({},r,{dataIntegrateId:e,IDs:b.default.renewUpdateIds(C),remark:n,config:s,priority:u,isIncrement:o,condition:d,type:i}))})},a.handleEchoData=function(e){var t,a=e.dataFlows,l=e.dataIntegrate,r=e.integrateSources,n=e.sourceTabRelations;r=b.default.setDefaults(r,[]);var s=v.default.map(r,function(e){return t=e.sourceId,e.sourceTableName=e.sourceTabName,e});l=b.default.setDefaults(l,{}),a=b.default.setDefaults(a,[]);var u=l,o=u.sourceId,d=u.targetTabName,c=[],i=[],f=[],m=[];v.default.map(a,function(e){c.push({sourceDatasourceId:e.sourceDatasourceId,sourceTableName:e.sourceTableName}),i.push({sourceFieldName:e.sourceFieldName}),f.push({rule:e.rule}),m.push({id:e.id,targetTableName:e.targetTableName,targetFieldName:e.targetFieldName,rule:e.rule})}),n=b.default.setDefaults(n,[]);var g=[];return v.default.map(n,function(e){g.push({id:e.id,integrateId:e.integrateId,left:e.leftField,leftTable:e.leftTabName,right:e.rightField,rightTable:e.rightTabName})}),{dataSourceId:t,selected_sourceTables:s,dataTargetId:o,selected_targetTable:d,selected_rows_sourceTables:c,selected_rows_sourceColumns:i,selected_rows_rules:f,targetFieldNames:m,relationshipData:g}},a.goBack=function(){a.props.dispatch(N.routerRedux.goBack())},a.changeDataItemRelation=function(e){a.setState({dataItemRelation:e})},a.state={IDs:C,dataItemRelation:{}},a}return(0,h.default)(t,e),(0,f.default)(t,[{key:"componentDidMount",value:function(){var e=this.state.dataIntegrateId;b.default.notNull(e)&&-1!=e?this.getEchoData(e):this.setState({IDs:b.default.renewUpdateIds(C)})}},{key:"render",value:function(){var e=this.state,t=e.IDs,a=e.dataIntegrateId,l=void 0===a?"":a,r=e.dataSourceId,s=e.selected_sourceTables,u=void 0===s?[]:s,o=e.dataTargetId,c=e.selected_targetTable,i=e.selected_rows_sourceTables,f=void 0===i?[]:i,m=e.selected_rows_sourceColumns,g=void 0===m?[]:m,h=e.selected_rows_rules,v=void 0===h?[]:h,b=e.targetFieldNames,T=void 0===b?[]:b,_=e.relationshipData,N=void 0===_?[]:_,C=e.remark,S=e.config,w=e.condition,k=e.type,D=void 0===k?0:k,F=e.priority,O=e.isIncrement,M=void 0===O?0:O,R=e.dataItemRelation,P=E.default.parse(this.props.location.search.slice(1)),x=P.sourceName;return p.default.createElement("div",null,p.default.createElement(d.default,{onClick:this.goBack,style:{marginBottom:10},size:"small"},"\u8fd4\u56de"),p.default.createElement("div",{className:"flex column grow1",style:{minHeight:"75vh"}},p.default.createElement("div",{className:"flex stretch grow1 m-top20",style:{backgroundColor:"#F0F2F5"}},p.default.createElement(y.default,(0,n.default)({style:{marginRight:"20px"}},{dataSourceId:r,selected_sourceTables:u},{ID:t[0],sourceName:x,changeDataItemRelation:this.changeDataItemRelation})),p.default.createElement(I.default,(0,n.default)({ID:t[1],sourceName:x},{dataIntegrateId:l,selected_sourceTables:u,dataTargetId:o,selected_targetTable:c,selected_rows_sourceTables:f,selected_rows_sourceColumns:g,selected_rows_rules:v,targetFieldNames:T,relationshipData:N,remark:C,config:2===D?["",S]:[S,""],condition:w,type:D,priority:F,isIncrement:M},{dataItemRelation:R})))))}}],[{key:"getDerivedStateFromProps",value:function(e,t){var a=v.default.get(e,"match.params.id","");return-1!=a&&a!==t.dataIntegrateId?{dataIntegrateId:a}:null}}]),t}(p.Component),u=o))||u);t.default=S},PXRC:function(e,t,a){"use strict";var l=a("tAuX"),r=a("g09b");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("2qtc");var n=r(a("kLXV"));a("14J3");var s=r(a("BMrR"));a("Pwec");var u=r(a("CtXQ"));a("jCWc");var o=r(a("kPKH")),d=r(a("2Taf")),c=r(a("vZ4D")),i=r(a("l4Ni")),f=r(a("ujKo")),m=r(a("MhPg"));a("OaEy");var g=r(a("2fM7")),h=l(a("q1tI")),p=r(a("LvDl")),v=r(a("Mosh")),b=g.default.Option,T=function(e){function t(e){var a;return(0,d.default)(this,t),a=(0,i.default)(this,(0,f.default)(t).call(this,e)),a.generateTableOptions=function(){var e=a.state.selected_sourceTables;return p.default.map(e,function(e){var t=e.sourceTableName;return h.default.createElement(b,{key:t},t)})},a.onOk=function(){a.setState({visible:!1},function(){var e=a.state,t=e.leftTable,l=e.rightTable,r=e.columnPairs,n=[];p.default.map(r,function(e){var a=e.left,r=e.right;v.default.notNull(a)&&v.default.notNull(r)&&n.push({left:a,right:r,leftTable:t,rightTable:l})}),a.props.close(n)})},a.onCancel=function(){a.setState({visible:!1})},a.leftTableChange=function(e){a.setState(function(t){var a=t.columnPairs;return p.default.map(a,function(e){e.left=void 0}),{columnPairs:a,leftTable:e}})},a.rightTableChange=function(e){a.setState(function(t){var a=t.columnPairs;return p.default.map(a,function(e){e.right=void 0}),{columnPairs:a,rightTable:e}})},a.columnChange=function(e,t,l){a.setState(function(a){var r=a.columnPairs;return r[t][l]=e,{columnPairs:r}})},a.addRow=function(){a.setState(function(e){var t=e.columnPairs;return t.push({_key:v.default.uuid(),left:void 0,right:void 0}),{columnPairs:t}})},a.deleteRow=function(e){a.setState(function(t){var a=t.columnPairs;return a.splice(e,1),{columnPairs:a}})},a.state={leftTable:void 0,rightTable:void 0,columnPairs:[{_key:v.default.uuid(),left:void 0,right:void 0}]},a}return(0,m.default)(t,e),(0,c.default)(t,[{key:"render",value:function(){var e=this,t=this.state,a=t.visible,l=(t.sourceTableMap,t.leftTable),r=t.rightTable,d=t.columnPairs,c=t.fieldObj,i=this.generateTableOptions(),f=c[l]?c[l].columnsList:[],m=c[r]?c[r].columnsList:[];return h.default.createElement(n.default,{title:"\u6dfb\u52a0\u5173\u8054\u5173\u7cfb",visible:a,onOk:this.onOk,onCancel:this.onCancel,bodyStyle:{maxHeight:"300px",overflow:"auto"}},h.default.createElement(s.default,{gutter:20,className:"flex v-center p-v5",style:{marginRight:"0px",marginLeft:"0px"}},h.default.createElement(o.default,{span:10},h.default.createElement(g.default,{size:"small",placeholder:"--\u8bf7\u9009\u62e9\u8868--",onChange:this.leftTableChange,value:l,className:"w-p100"},i)),h.default.createElement(o.default,{span:10},h.default.createElement(g.default,{size:"small",placeholder:"--\u8bf7\u9009\u62e9\u8868--",onChange:this.rightTableChange,value:r,className:"w-p100"},i)),h.default.createElement(o.default,{span:4},h.default.createElement(u.default,{type:"plus-circle",theme:"outlined",className:"cs-pointer",onClick:this.addRow,style:{fontSize:"18px"}}))),p.default.map(d,function(t,a){return h.default.createElement(s.default,{key:t._key,gutter:20,className:"flex v-center p-v5",style:{marginRight:"0px",marginLeft:"0px"}},h.default.createElement(o.default,{span:10},h.default.createElement(g.default,{size:"small",placeholder:"--\u8bf7\u9009\u62e9\u5b57\u6bb5--",onChange:function(t){return e.columnChange(t,a,"left")},value:t.left,className:"w-p100"},p.default.map(f,function(e){var t=e.name;return h.default.createElement(b,{key:t},h.default.createElement(u.default,{type:"table",theme:"outlined",className:"m-h5"}),t)}))),h.default.createElement(o.default,{span:10},h.default.createElement(g.default,{size:"small",placeholder:"--\u8bf7\u9009\u62e9\u5b57\u6bb5--",onChange:function(t){return e.columnChange(t,a,"right")},value:t.right,className:"w-p100"},p.default.map(m,function(e){var t=e.name;return h.default.createElement(b,{key:t},h.default.createElement(u.default,{type:"table",theme:"outlined",className:"m-h5"}),t)}))),h.default.createElement(o.default,{span:4},h.default.createElement(u.default,{type:"close-circle",theme:"outlined",className:"cs-pointer",onClick:function(){return e.deleteRow(a)},style:{fontSize:"18px"}})))}))}}],[{key:"getDerivedStateFromProps",value:function(e,t){return e.ID!==t.ID?e:null}}]),t}(h.Component);t.default=T},lFrO:function(e,t,a){"use strict";var l=a("tAuX"),r=a("g09b");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=r(a("jehZ"));a("+L6B");var s=r(a("2/Rp"));a("5Dmo");var u=r(a("3S7+")),o=r(a("gWZ8"));a("14J3");var d=r(a("BMrR"));a("Pwec");var c=r(a("CtXQ"));a("jCWc");var i=r(a("kPKH"));a("miYZ");var f=r(a("tsqr")),m=r(a("p0pE")),g=r(a("2Taf")),h=r(a("vZ4D")),p=r(a("l4Ni")),v=r(a("ujKo")),b=r(a("MhPg"));a("5NDa");var T=r(a("5rEg"));a("OaEy");var _=r(a("2fM7")),N=l(a("q1tI")),E=a("MuoO"),I=a("ArA+"),y=r(a("LvDl")),C=r(a("Mosh")),S=a("E5h/"),w=a("7z+u"),k=a("Amfe"),D=r(a("/iXv")),F=r(a("18GJ")),O=r(a("PXRC")),M=_.default.Option,R=T.default.TextArea,P=function(e){function t(e){var a;return(0,g.default)(this,t),a=(0,p.default)(this,(0,v.default)(t).call(this,e)),a.generateDataTargetOptions=function(){var e=a.props.sourceName;return(0,w.queryTargetDataSource)({sourceName:e}).then(function(e){var t={},l=C.default.setDefaults(y.default.get(e,"obj"),{}),r=y.default.map(l,function(e){var a=e.id,l=e.sourceName;return a+="",t[a]=e,N.default.createElement(M,{id:a,key:a},l)});a.setState({dataTargetOptions:r,dataTargetIdMap:t}),a.state.dataTargetId||a.setState({dataTargetId:e.obj[0].id})})},a.dataSourceChange=function(e){a.setState({dataTargetId:e,targetTableOptions:[],selected_targetTable:void 0,rows_sourceColumns:[],selected_rows_sourceTables:[],selected_rows_sourceColumns:[],targetFieldNames:[]},a.generateTargetTableOptions)},a.generateTargetTableOptions=function(){var e=a.state.dataTargetId,t=a.props.dataIntegrateId;if(C.default.notNull(e))return(0,w.getTablesAndColumnsInfoForIntegrate)({datasourceId:e,dataIntegerId:t}).then(function(e){var t=C.default.setDefaults(y.default.get(e,"obj"),[]),l=y.default.map(t,function(e){var t=e.sourceId,a=e.tableName,l=e.tableNameCn;return N.default.createElement(M,{"data-sourceid":t,key:a},a,l?"--".concat(l):"")});a.setState({targetTableOptions:l})})},a.targetTableChange=function(e){var t=e.key,l=e.label;a.setState(function(e){var a=e.selected_targetTable;return a=t||a,{selected_targetTable:a,selected_targetTableCn:l[1].slice(2),rows_sourceColumns:[],selected_rows_sourceTables:[],selected_rows_sourceColumns:[],selected_rows_rules:[],targetFieldNames:[]}},function(){var e=a.state,t=e.dataTargetId,l=e.dataTargetIdMap,r=e.selected_targetTable;t=l[t]?"".concat(t):void 0,a.renderDataFlowTable(t,r,2)}),a.hasPushId=[]},a.reloadTargetTable=function(){var e=a.state,t=e.selected_targetTable,l=e.targetTableOptions,r=l.find(function(e){return e.key===t});r&&a.targetTableChange({key:t,label:r.props.children})},a.renderDataFlowTable=function(e,t,l){var r=a.state.selected_targetTable;(0,w.getColunm)({datasourceId:e,tableName:t}).then(function(e){var t=a.state,n=t.dataSourceId,s=t.selected_sourceTables,u=void 0===s?[]:s,o=t.sourceTableMap,d=void 0===o?{}:o,c=t.rows_sourceColumns,i=t.selected_rows_sourceTables,f=t.selected_rows_sourceColumns,g=y.default.get(u[0],"sourceTableName"),h=d[g]||{},p=y.default.get(h,"__$$columnsList$$__",[]),v=C.default.setDefaults(y.default.get(e,"obj"),[]),b=[];if(y.default.map(v,function(e){var t=e.tableName,a=e.columnsList,l=void 0===a?[]:a;t==r&&y.default.map(l,function(e,t){var a=e.name,l=!!h[a];l&&(c[t]=p,i[t]={sourceDatasourceId:n,sourceTableName:g},f[t]={sourceFieldName:a}),b.push({targetTableName:r,targetFieldName:a})})}),b=b.length?b:a.state.targetFieldNames,1===l){var T=(0,m.default)({},a.state.fieldObj);e.obj.forEach(function(e){T[e.tableName]=e}),a.setState({rows_sourceColumns:c,selected_rows_sourceTables:i,selected_rows_sourceColumns:f,fieldObj:T})}else a.setState({rows_sourceColumns:c,selected_rows_sourceTables:i,selected_rows_sourceColumns:f,targetFieldNames:b})})},a.dataSourceTableChange=function(e,t){a.setState(function(l){var r=l.dataSourceId,n=l.sourceTableMap,s=void 0===n?{}:n,u=l.rows_sourceColumns,o=l.selected_rows_sourceTables,d=l.selected_rows_sourceColumns,c=l.targetFieldNames,i=y.default.get(c[t],"targetFieldName"),f=s[e]||{},m=y.default.get(f,"__$$columnsList$$__",[]);u[t]=m,o[t]={sourceDatasourceId:r,sourceTableName:e};var g=f[i]?i:void 0;if(!g&&a.initFieldNames){var h=a.initFieldNames.find(function(e){return e.targetFieldName===i});h&&(g=h.sourceFieldName)}return d[t]={sourceFieldName:g},{rows_sourceColumns:u,selected_rows_sourceTables:o,selected_rows_sourceColumns:d}})},a.dataSourceColumnChange=function(e,t){a.setState(function(a){var l=a.selected_rows_sourceColumns;return l[t]={sourceFieldName:e},{selected_rows_sourceColumns:l}})},a.ruleChange=function(e,t){a.setState(function(a){var l=a.selected_rows_rules;return l[t]={rule:e},{selected_rows_rules:l}})},a.showRelationshipModal=function(){var e=a.state.selected_sourceTables,t=void 0===e?[]:e;t.length<2?f.default.warning("\u8bf7\u9009\u62e9\u81f3\u5c11\u4e24\u5f20\u6e90\u8868."):a.setState({visible:!0,modalKey:C.default.uuid()})},a.showRelationModal=function(){var e=a.state.selected_sourceTables,t=void 0===e?[]:e;t.length<2?f.default.warning("\u8bf7\u9009\u62e9\u81f3\u5c11\u4e24\u5f20\u6e90\u8868."):a.setState({relationModalVisible:!0})},a.closeRelationshipModal=function(e){a.setState(function(t){var a=t.relationshipData;return a=y.default.chain(a).concat(e).uniqWith(y.default.isEqual).value(),{visible:!1,relationshipData:a}})},a.closeRelationModal=function(){a.setState({relationModalVisible:!1})},a.deleteRelationship=function(e){a.setState(function(t){var a=t.relationshipData;return a.splice(e,1),{relationshipData:a}})},a.submit=function(){var e=a.state,t=e.dataIntegrateId,l=void 0===t?"":t,r=e.dataSourceId,n=e.selected_sourceTables,s=e.dataTargetId,u=e.selected_targetTable,o=e.selected_targetTableCn,d=e.selected_rows_sourceTables,c=e.selected_rows_sourceColumns,i=e.targetFieldNames,m=e.relationshipData,g=(e.priority,e.isIncrement),h=e.remark,p=void 0===h?"":h,v=e.config,b=e.condition,T=e.type,_=e.selected_rows_rules;if(C.default.isNull(n)||C.default.isNull(c))f.default.warning("\u8bf7\u9009\u62e9\u6e90\u6570\u636e\u548c\u76ee\u6807\u6570\u636e.");else if(n.length>=2&&C.default.isNull(m)&&0===T)f.default.warning("\u8bf7\u6dfb\u52a0\u5173\u8054\u5173\u7cfb.");else if(void 0!==g){var N=o;if(!N){var E=document.querySelector(".selectTarget").innerText.split("--");N=E[E.length-1]}var S={dataIntegrate:{id:l,sourceId:s,targetTabName:u,targetTabNameCn:N,isIncrement:g,remark:p,config:2===T?v[1]:v[0],condition:b,type:T},integrateSources:[],sourceTabRelations:[],dataFlows:[]};y.default.map(n,function(e){var t=e.id,r=void 0===t?"":t,n=e.sourceId,s=e.sourceTableName;S.integrateSources.push({id:r,integrateId:l,sourceId:n||a.state.dataSourceId,sourceTabName:s})}),y.default.map(m,function(e){var t=e.id,a=void 0===t?"":t,l=e.integrateId,r=void 0===l?"":l,n=e.leftTable,s=e.rightTable,u=e.left,o=e.right;S.sourceTabRelations.push({id:a,integrateId:r,joinRelation:2,leftField:u,leftTabName:n,rightField:o,rightTabName:s})}),y.default.map(i,function(e,t){var a=e.id,l=void 0===a?"":a,n=e.targetTableName,u=e.targetFieldName,o=y.default.get(d[t],"sourceTableName"),i=y.default.get(c[t],"sourceFieldName"),f=_[t]?_[t].rule:"";C.default.notNull(o)&&(C.default.notNull(i)||C.default.notNull(f))&&S.dataFlows.push({id:l,sourceDatasourceId:r,sourceTableName:o,sourceFieldName:i,targetDatasourceId:s,targetTableName:n,targetFieldName:u,rule:f})}),(0,k.saveOrUpdate)(S).then(function(e){var t=e.success,a=e.msg,l=void 0===a?"":a;1==t?(f.default.success(l),I.router.goBack()):f.default.error(l)})}else f.default.warning("\u8bf7\u6dfb\u52a0\u96c6\u6210\u65b9\u5f0f.")},a.changInputNumber=function(e){var t=Number.parseFloat(e)||void 0;a.setState({priority:t})},a.changIsIncrement=function(e){a.setState({isIncrement:e})},a.changType=function(e){a.setState({type:e})},a.changInput=function(e){var t=e.target.value;a.setState({remark:t})},a.changConfig=function(e){var t=[a.state.config[0],e.target.value];a.setState({config:t})},a.changCondition=function(e){a.setState({condition:e.target.value.slice(0,1e3)})},a.submitRelation=function(e){(0,w.sourceTabRelations)(e).then(function(e){e&&e.success&&(a.setState({relation:e.obj}),a.closeRelationModal())})},a.deleteRelation=function(){a.setState({relation:""})},a.state={dataSourceId:"",selected_sourceTables:[],sourceTableMap:{},dataIntegrateId:"",dataTargetId:void 0,dataTargetOptions:[],dataTargetIdMap:{},targetTableOptions:[],selected_targetTable:void 0,selected_targetTableCn:void 0,rows_sourceColumns:[],selected_rows_sourceTables:[],selected_rows_sourceColumns:[],targetFieldNames:[],visible:!1,modalKey:0,relationshipData:[],priority:void 0,isIncrement:void 0,remark:"",condition:"",type:void 0,config:[],fieldObj:{},relationModalVisible:!1,relation:""},a}return(0,b.default)(t,e),(0,h.default)(t,[{key:"componentDidUpdate",value:function(e,t){this.props.ID!==e.ID&&this.generateDataTargetOptions().then(this.generateTargetTableOptions),this.state.selected_sourceTables!==t.selected_sourceTables&&(this.hasPushId=[]);var a=this.state,l=a.targetFieldNames,r=a.selected_rows_sourceColumns;this.props.dataIntegrateId&&!this.initFieldNames&&l.length&&r.length&&(this.initFieldNames=l.map(function(e,t){return(0,m.default)({},e,r[t])}))}},{key:"render",value:function(){var e=this,t=this.state,a=t.selected_sourceTables,l=void 0===a?[]:a,r=t.fieldObj,f=this.state,m=f.dataTargetId,g=f.dataTargetOptions,h=f.dataTargetIdMap,p=f.targetTableOptions,v=f.selected_targetTable,b=(f.rows_sourceColumns,f.selected_rows_sourceTables),E=f.selected_rows_sourceColumns,I=f.selected_rows_rules,C=f.targetFieldNames,S=f.relationshipData,w=f.modalKey,k=(f.priority,f.isIncrement),D=f.remark,P=f.condition,x=f.type,j=f.config,A=f.relationModalVisible,L=f.relation;m=h[m]?"".concat(m):void 0;var z=this.props,$=z.style,q=void 0===$?{}:$,U=z.sourceName,X=z.dataItemRelation,B=void 0===X?{}:X;return N.default.createElement("div",{className:"grow1 bg-white",style:q},N.default.createElement("div",{className:"padding20"},N.default.createElement("strong",{className:"block m-bottom10"},"\u76ee\u7684\u8868"),N.default.createElement(d.default,{gutter:20},N.default.createElement(i.default,{span:12},N.default.createElement(_.default,{placeholder:"--\u8bf7\u9009\u62e9\u6570\u636e\u6e90--",showSearch:!0,optionFilterProp:"children",value:m,onChange:this.dataSourceChange,className:"w-p100"},g)),N.default.createElement(i.default,{span:12},N.default.createElement(_.default,{placeholder:"--\u8bf7\u9009\u62e9\u8868--",showSearch:!0,labelInValue:!0,value:v&&{key:v},onChange:this.targetTableChange,className:"selectTarget w-p100"},p),N.default.createElement(c.default,{style:{position:"absolute",marginTop:8,marginLeft:5},className:"can-click",type:"reload",title:"\u5237\u65b0",onClick:this.reloadTargetTable}))),N.default.createElement(d.default,{gutter:20,style:{marginTop:10}},N.default.createElement(i.default,{span:12},N.default.createElement(_.default,{style:{width:"100%"},value:k,placeholder:"--\u8bf7\u9009\u62e9\u96c6\u6210\u65b9\u5f0f--",onChange:this.changIsIncrement},N.default.createElement(M,{value:-1},"\u6d41\u6c34\u8868"),N.default.createElement(M,{value:1},"\u975e\u6d41\u6c34\u8868\u589e\u91cf"),N.default.createElement(M,{value:0},"\u975e\u6d41\u6c34\u8868\u5168\u91cf"))),N.default.createElement(i.default,{span:12},N.default.createElement(_.default,{style:{width:"100%"},value:x,placeholder:"--\u8bf7\u9009\u62e9\u96c6\u6210\u7c7b\u578b--",onChange:this.changType},N.default.createElement(M,{value:0},"\u754c\u9762\u914d\u7f6e"),N.default.createElement(M,{value:1},"\u5b58\u50a8\u8fc7\u7a0b"),N.default.createElement(M,{value:2},"sql")))),N.default.createElement(d.default,{gutter:20,style:{marginTop:10}},N.default.createElement(i.default,{span:12},N.default.createElement(T.default,{placeholder:"--\u8fc7\u6ee4\u6761\u4ef6--",value:P,onChange:this.changCondition})),N.default.createElement(i.default,{span:12},N.default.createElement(T.default,{placeholder:"--\u8bf7\u8f93\u5165\u8bf4\u660e--",value:D,onChange:this.changInput,className:"w-p100"}))),N.default.createElement(d.default,{gutter:20,style:{marginTop:10}},N.default.createElement(i.default,{span:24},2===x&&N.default.createElement(R,{rows:5,placeholder:"sql \u8bed\u53e5",value:j[1],onChange:this.changConfig})))),N.default.createElement(d.default,{gutter:24,className:"p-v10 bg-F5FAFC",style:{marginRight:0,marginLeft:0}},N.default.createElement(i.default,{span:6,className:"text-center"},N.default.createElement("strong",null,"\u6765\u6e90\u8868")),N.default.createElement(i.default,{span:6,className:"text-center"},N.default.createElement("strong",null,"\u6765\u6e90\u8868\u5b57\u6bb5")),N.default.createElement(i.default,{span:6,className:"text-center"},N.default.createElement("strong",null,"\u89c4\u5219")),N.default.createElement(i.default,{span:6,className:"text-center"},N.default.createElement("strong",null,"\u76ee\u7684\u8868\u5b57\u6bb5"))),N.default.createElement("div",{style:{minHeight:"250px",maxHeight:"250px",overflow:"auto"}},y.default.map(C,function(t,a){var n=t.targetFieldName,s=y.default.get(e.state.selected_rows_sourceTables[a],"sourceTableName"),u=r[s]?r[s].columnsList:[],f=e.hasPushId,m=void 0===f?[]:f,g=y.default.get(E[a],"sourceFieldName");y.default.get(b[a],"sourceTableName")||m.includes(a)||(e.dataSourceTableChange(l[0]&&l[0].sourceTableName,a),e.hasPushId=[].concat((0,o.default)(m),[a]));var h=!1;if(!g&&"1"===localStorage.getItem("TRANSLATE")&&"\u6807\u51c6\u5e93"===U){var p=n&&B.transformRuleList&&B.transformRuleList.find(function(e){return e.dataItemName&&e.dataItemName.toUpperCase()===n.toUpperCase()});if(p){var v=u.find(function(e){return e.name&&p.tableField&&e.name.toUpperCase()===p.tableField.toUpperCase()});v&&(g=v.name,e.dataSourceColumnChange(g,a),h=!0)}}if(!h&&!g){var C=u.find(function(e){return e.name&&n&&e.name.toUpperCase()===n.toUpperCase()});C&&e.dataSourceColumnChange(C.name,a)}return N.default.createElement(d.default,{gutter:24,className:"flex v-center p-v10 m-v5 border-bottom-dashed last-none",key:n,style:{marginRight:0,marginLeft:0}},N.default.createElement(i.default,{span:6,className:"text-center"},N.default.createElement(_.default,{size:"small",placeholder:"--\u8bf7\u9009\u62e9\u8868--",showSearch:!0,optionFilterProp:"children",value:y.default.get(b[a],"sourceTableName"),onChange:function(t){return e.dataSourceTableChange(t,a)},className:"w-p100",allowClear:!0},y.default.map(l,function(e){var t=e.sourceTableName;return N.default.createElement(M,{key:t},t)}))),N.default.createElement(i.default,{span:6,className:"text-center"},N.default.createElement(_.default,{size:"small",placeholder:"--\u8bf7\u9009\u62e9\u5b57\u6bb5--",showSearch:!0,optionFilterProp:"children",value:g,onChange:function(t){return e.dataSourceColumnChange(t,a)},className:"w-p100"},y.default.map(u,function(e){var t=e.name;return N.default.createElement(M,{key:t},t)}))),N.default.createElement(i.default,{span:6,className:"text-center"},N.default.createElement(T.default,{value:y.default.get(I[a],"rule"),onChange:function(t){return e.ruleChange(t.target.value,a)},placeholder:"--\u8bf7\u8f93\u5165\u89c4\u5219--"})),N.default.createElement(i.default,{span:6,className:"text-center"},N.default.createElement(c.default,{type:"table",style:{color:"#5172a5",padding:"0 5px"}}),n))})),N.default.createElement(d.default,{className:"p-v10 p-h20",style:{backgroundColor:"#F5FAFC"}},L&&N.default.createElement(d.default,{gutter:15,className:"h-l30"},N.default.createElement(i.default,{span:22,className:"ellipsis"},N.default.createElement(u.default,{title:L,overlayStyle:{width:500}},L)),N.default.createElement(i.default,{span:2},N.default.createElement(c.default,{type:"delete",theme:"outlined",className:"cs-pointer",style:{fontSize:"16px"},onClick:this.deleteRelation}))),N.default.createElement(i.default,{span:18},y.default.map(S,function(t,a){var l=t.leftTable,r=t.rightTable,n=t.left,s=t.right,o="".concat(l,"\u5185\u5173\u8054").concat(r,"\uff1b\u5173\u8054\u5173\u7cfb\uff1a").concat(n,"=").concat(s);return N.default.createElement(d.default,{key:a,gutter:15,className:"h-l30"},N.default.createElement(i.default,{span:22,className:"ellipsis"},N.default.createElement(u.default,{title:o,overlayStyle:{width:500}},o)),N.default.createElement(i.default,{span:2},N.default.createElement(c.default,{type:"delete",theme:"outlined",className:"cs-pointer",style:{fontSize:"16px"},onClick:function(){return e.deleteRelationship(a)}})))}))),N.default.createElement("div",{style:{textAlign:"right"}},["172.16.16.111","localhost"].includes(location.hostname)&&N.default.createElement(s.default,{type:"primary",size:"small",onClick:this.showRelationModal,style:{marginRight:10}},"\u7f16\u8f91\u5173\u8054"),N.default.createElement(s.default,{type:"primary",size:"small",onClick:this.showRelationshipModal},"\u6dfb\u52a0\u5173\u8054"),N.default.createElement(s.default,{type:"primary",size:"small",onClick:this.submit,style:{margin:"0 1em"}},"\u63d0\u4ea4")),N.default.createElement(F.default,{data:[],visible:A,fieldObj:r,close:this.closeRelationModal,submit:this.submitRelation}),N.default.createElement(O.default,(0,n.default)({},y.default.pick(this.state,["visible","selected_sourceTables","sourceTableMap","fieldObj"]),{ID:w,key:w,close:this.closeRelationshipModal})))}}],[{key:"getDerivedStateFromProps",value:function(e,t){return e.ID!==t.ID?e:null}}]),t}(N.Component),x=(0,E.connect)()((0,S.connect)([{action:D.default.left_right_reset_sourceTableAndSourceTableColumns,handler:function(e){this.setState((0,m.default)({},e,{rows_sourceColumns:[],selected_rows_sourceTables:[],selected_rows_sourceColumns:[]}))}},{action:D.default.left_right_add_sourceTableAndSourceTableColumns,handler:function(e){var t=this;e.selected_sourceTables;this.setState((0,m.default)({},e),function(){t.renderDataFlowTable(e.dataSourceId,e.tableName,1)})}},{action:D.default.left_right_refresh_sourceTableAndSourceTableColumns,handler:function(e){var t=e.deletedSourceTable,a=void 0===t?{}:t,l=e.sourceTableMap,r=void 0===l?{}:l,n=a.sourceTableName;this.setState(function(t){var a=t.rows_sourceColumns,l=t.selected_rows_sourceTables,s=t.selected_rows_sourceColumns,u=t.targetFieldNames;return y.default.map(u,function(e,t){var u=y.default.get(l[t],"sourceTableName");n===u?(a[t]=[],l[t]={},s[t]={}):a[t]=y.default.get(r[u],"__$$columnsList$$__",[])}),(0,m.default)({},e,{rows_sourceColumns:a,selected_rows_sourceTables:l,selected_rows_sourceColumns:s})})}}])(P));t.default=x},oLOj:function(e,t,a){e.exports={primaryTable:"primaryTable___2oloC",flex:"flex___tand5",relationship:"relationship___1HJlF",condition:"condition___25Y-c",select:"select___14hWW"}}}]);