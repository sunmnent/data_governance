(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[35],{"68Nj":function(e,t,a){e.exports={searchLi:"searchLi___3Irkw"}},WDF8:function(e,t,a){"use strict";var s=a("tAuX"),r=a("g09b");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("Pwec");var i=r(a("CtXQ")),l=r(a("d6i3")),n=r(a("1l/V"));a("5NDa");var o=r(a("5rEg")),d=s(a("q1tI")),h=r(a("lfuW")),c=r(a("68Nj")),u=a("7cA1"),m=r(a("eJJh"));o.default.Search;class p extends d.Component{constructor(){var e;super(...arguments),e=this,this.state={changeArr:[],searchResultShow:!1,isShow:!1,dataObj:[],msg:null},this.tablesGroupByDepartment=(0,n.default)(l.default.mark(function t(){var a,s,r,i,n,o,d;return l.default.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(a=e.state.changeArr,0!==a.length){t.next=9;break}return t.next=4,(0,u.finZ)();case 4:i=t.sent,s=i.obj,r=i.msg,t.next=23;break;case 9:if(1!==a.length){t.next=17;break}return t.next=12,(0,u.querySys)({type:a[0]});case 12:n=t.sent,s=n.obj,r=n.msg,t.next=23;break;case 17:if(!(a.length>=2)){t.next=23;break}return t.next=20,(0,u.queryTable)({type:a[0],id:a[a.length-1]});case 20:o=t.sent,s=o.obj,r=o.msg;case 23:s&&(d=s.map((e,t)=>({id:e.id||e.type,name:e.name||e.catagoryName||e.tableNameCn,tableName:e.tableName,dataBaseId:e.dataBaseId,symbolSize:60,draggable:"true"})),e.setState({dataObj:d,msg:r}));case 24:case"end":return t.stop()}},t)})),this.getqueryAnalysisReport=(e=>{var t=e.target.value;(0,u.getTablesByName)({tableName:t}).then(e=>{if(e&&e.obj){var t=e.obj.map((e,t)=>{return d.default.createElement("li",{onClick:()=>this.liClick(e),key:e.id,"data-id":e.id,"data-value":e.tableName,"data-aa":e.tableChineseName,style:{height:"30px",lineHeight:"30px",width:"400px",border:"1px solid #40a9ff",textAlign:"left",cursor:"pointer"}},d.default.createElement("span",{style:{color:"blue",marginRight:"10px"}},e.tableName)," ",d.default.createElement("span",null,"(",e.dataSourceName,")"))});this.setState({liItems:t,searchResultShow:!0})}})}),this.liClick=(e=>{var t=e.dataSourceId;this.setState({isShow:!0,searchResultShow:!1,dataSourceIds:t});var a=e.tableNameCn,s=e.tableName,r=e.id;this.setState({tableName:s,datasourceId:r,tableNameCN:a,liItems:[]})}),this.metaDataRelation=(()=>{var e={textStyle:{},tooltip:{formatter:"{b}"},series:[{name:"\u5173\u7cfb\u4f53\u7cfb",type:"graph",layout:"force",force:{repulsion:110,gravity:.1,edgeLength:30,layoutAnimation:!0},focusNodeAdjacency:!0,symbol:"circle",symbolSize:[100,400],data:this.state.dataObj,links:this.state.links,categories:this.state.dataObj.map(e=>e.id),roam:!1,label:{normal:{show:!0,position:"inside",formatter:e=>{var t=e.data.name,a=4;return t.length>a?t.slice(0,a)+"...":t},fontSize:16,fontStyle:"600"},emphasis:{formatter:e=>{return e.data.name}}}}]};return e}),this.onEvents={click:e=>{var t=[...this.state.changeArr,e.data.id],a=this.state.msg;if("\u8868"!==a)this.setState({changeArr:t}),this.tablesGroupByDepartment();else{var s=e.data.dataBaseId,r=e.data.dataBaseId,i=e.data.name,l=e.data.tableName;this.setState({isShow:!0,dataSourceIds:s,tableName:l,datasourceId:r,tableNameCN:i})}}},this.back=(e=>{if(1===e)this.setState({isShow:!1},()=>{this.tablesGroupByDepartment()});else if(2===e){var t=this.state.changeArr;t.pop(),this.setState({changeArr:t},()=>{this.tablesGroupByDepartment()})}}),this.blurSearch=(()=>{setTimeout(()=>{this.setState({searchResultShow:!1})},300)})}componentDidMount(){this.tablesGroupByDepartment()}render(){var e=this.state.searchResultShow;return d.default.createElement("div",{style:{background:"white",position:"relative"}},d.default.createElement("div",{style:{position:"relative",margin:"0 auto",textAlign:"center",minHeight:"50px"}},this.state.isShow?d.default.createElement("div",{style:{textAlign:"left"}},d.default.createElement(i.default,{onClick:this.back.bind(this,1),type:"backward",style:{marginLeft:"20px",marginTop:"20px",cursor:"pointer"}}),d.default.createElement(m.default,{tableName:this.state.tableName,tableNameCN:this.state.tableNameCN,datasourceId:this.state.dataSourceIds,type:1,height:500})):d.default.createElement("div",null,this.state.changeArr.length>0&&d.default.createElement(i.default,{onClick:this.back.bind(this,2),type:"backward",style:{marginLeft:"20px",marginTop:"20px",float:"left",cursor:"pointer"}}),d.default.createElement(o.default,{placeholder:"\u6309\u4e2d\u6587\u8868\u540d/\u82f1\u6587\u8868\u540d\u641c\u7d22",size:"large",style:{width:400,marginTop:"10px"},onPressEnter:this.getqueryAnalysisReport,onBlur:this.blurSearch}),e&&d.default.createElement("ul",{className:c.default.searchLi},this.state.liItems),d.default.createElement("div",{className:"echartRelative"},d.default.createElement(h.default,{onEvents:this.onEvents,option:this.metaDataRelation(),notMerge:!0,style:{height:550}})))))}}t.default=p}}]);