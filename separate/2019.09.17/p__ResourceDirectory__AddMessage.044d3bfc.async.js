(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[49],{phg6:function(e,t,a){"use strict";var l=a("g09b"),r=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("T2oS");var s=l(a("W9HT"));a("DZo9");var i=l(a("8z0m"));a("+L6B");var u=l(a("2/Rp"));a("Pwec");var d=l(a("CtXQ"));a("sRBo");var c=l(a("kaz8"));a("miYZ");var o=l(a("tsqr")),n=l(a("p0pE"));a("5NDa");var m=l(a("5rEg"));a("OaEy");var f=l(a("2fM7"));a("y8nQ");var p,h,b,y=l(a("Vl3Y")),v=r(a("q1tI")),g=a("MuoO"),E=(l(a("Jt6A")),l(a("Qyje"))),N=a("7DNP"),S=a("ATFn"),D=a("qxfp"),k=l(a("fym6")),R=y.default.Item,C=f.default.Option,A=m.default.TextArea,F=(p=(0,g.connect)(e=>{var t=e.resourceDirectory,a=e.cachedData,l=e.loading;return{resourceDirectory:t,cachedData:a,loading:l}}),p((b=class extends v.Component{constructor(){super(...arguments),this.state={value:{}},this.blurTableName=(e=>{var t=this.props.form,a=t.setFieldsValue,l=t.getFieldValue,r=t.validateFields;if(l("tableName")){var s=l("tableName").toUpperCase();a({tableName:s}),r(["tableName"])}}),this.changeSystem=(e=>{var t=this.props.form.setFieldsValue,a=this.props.resourceDirectory.systemList.find(t=>t.id===e);t({responsible:a&&a.account&&a.account.username})}),this.handleSubmit=(e=>{this.props.form.validateFieldsAndScroll((t,a)=>{if(!t){a.isAuth=a.isAuth?1:0,a.resourceType="M",a.fileUrl=this.state.value.fileUrl,a.fileName=this.state.value.fileName,delete a.responsible;var l=E.default.parse(this.props.location.search.slice(1)),r=l.id;this.props.dispatch({type:"resourceDirectory/saveResource",payload:(0,n.default)({id:r,submitState:e},a)})}})}),this.goBack=(()=>{this.props.dispatch(N.routerRedux.goBack())})}componentDidMount(){var e=this.props.resourceDirectory,t=e.systemList,a=e.secondCatagory;t.length||this.props.dispatch({type:"resourceDirectory/getSystemList"}),a.length||this.props.dispatch({type:"resourceDirectory/queurySecondCatagory"});var l=E.default.parse(this.props.location.search.slice(1)),r=l.id;r&&this.props.dispatch({type:"resourceDirectory/getResourceDetail",payload:r}).then(e=>{this.setState({value:e}),this.changeSystem(e.busSystemId)})}render(){var e=this.props.form.getFieldDecorator,t=this.props.resourceDirectory,a=t.systemList,l=t.secondCatagory,r=!0===this.props.loading.effects["resourceDirectory/getResourceDetail"],p=this.state.value,h=E.default.parse(this.props.location.search.slice(1)),b=h.id,g=h.saveBtn,N=h.type,F="".concat(D.BASE_URL,"/tableModelResource/uploadFile?token=").concat((0,D.TOKEN)());b&&(F+="&resourceId=".concat(b));var U={name:"file",action:F,onRemove:e=>{this.setState({value:(0,n.default)({},this.state.value,{fileUrl:"",fileName:""})})},beforeUpload:e=>{var t=new FormData;return t.append("file",e),fetch(F,{method:"POST",body:t}).then(e=>e.json()).then(e=>{e.success?(this.setState({value:(0,n.default)({},this.state.value,{fileUrl:e.obj.fileUrl,fileName:e.obj.fileName})}),o.default.success("\u6587\u4ef6\u4e0a\u4f20\u6210\u529f")):o.default.error(e.msg)}),!1},fileList:p.fileName?[{uid:"1",name:p.fileName,status:"done",url:"".concat(D.BASE_URL,"/tableModelResource/downloadFile?token=").concat((0,D.TOKEN)(),"&fileUrl=").concat(p.fileUrl,"&fileName=").concat(p.fileName)}]:[]},V=(e,t,a)=>{t&&!t.match(S.ENGLISH_CHART)&&a("\u8bf7\u8f93\u5165\u4ee5\u82f1\u6587\u5f00\u5934\u7684\u82f1\u6587\u540d"),a()},w="1"===N,T="0"!==g,q=!T||w;return v.default.createElement(s.default,{spinning:r},v.default.createElement("h1",{className:k.default.title},b?"\u7f16\u8f91":"\u65b0\u5efa","\u6d88\u606f"),v.default.createElement(y.default,{className:k.default.form},v.default.createElement(R,{label:"\u8d44\u6e90\u540d\u79f0"},e("tableName",{initialValue:p.tableName,rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u8d44\u6e90\u540d\u79f0"},{max:20,message:"\u6700\u591a20\u4e2a\u5b57\u7b26"},{validator:V}]})(v.default.createElement(m.default,{disabled:q,onBlur:this.blurTableName,placeholder:"\u8bf7\u8f93\u5165\u8d44\u6e90\u540d\u79f0"}))),v.default.createElement(R,{label:"\u4e2d\u6587\u63cf\u8ff0"},e("tableNameCn",{initialValue:p.tableNameCn,rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u4e2d\u6587\u63cf\u8ff0"}]})(v.default.createElement(m.default,{placeholder:"\u8bf7\u8f93\u5165\u4e2d\u6587\u63cf\u8ff0"}))),v.default.createElement(R,{label:"\u6e90\u7cfb\u7edf"},e("busSystemId",{initialValue:p.busSystemId||a[0]&&a[0].id,rules:[{required:!0,message:"\u8bf7\u9009\u62e9\u6e90\u7cfb\u7edf"}]})(v.default.createElement(f.default,{disabled:q,placeholder:"\u8bf7\u9009\u62e9\u6e90\u7cfb\u7edf",onChange:this.changeSystem,showSearch:!0,optionFilterProp:"children"},a.map(e=>v.default.createElement(C,{value:e.id,key:e.id},e.name))))),v.default.createElement(R,{label:"\u8d23\u4efb\u4eba"},e("responsible",{initialValue:a[0]&&a[0].account&&a[0].account.username,rules:[{required:!0,message:"\u8bf7\u9009\u62e9\u8d23\u4efb\u4eba"}]})(v.default.createElement(m.default,{disabled:!0}))),v.default.createElement(R,{label:"\u4e3b\u9898"},e("classifyId",{initialValue:p.classifyId,rules:[{required:!0,message:"\u8bf7\u9009\u62e9\u4e3b\u9898"}]})(v.default.createElement(f.default,{placeholder:"\u8bf7\u9009\u62e9\u4e3b\u9898"},l.map(e=>v.default.createElement(C,{value:e.id,key:e.id},e.name))))),v.default.createElement(R,{label:"\u670d\u52a1url"},e("url",{initialValue:p.url,rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u670d\u52a1url"}]})(v.default.createElement(m.default,{placeholder:"\u8bf7\u8f93\u5165\u670d\u52a1url"}))),v.default.createElement(R,{label:"\u5907\u6ce8"},e("tableDesc",{initialValue:p.tableDesc})(v.default.createElement(A,{rows:4,placeholder:"\u8bf7\u8f93\u5165\u5907\u6ce8\u4fe1\u606f"}))),v.default.createElement(R,{label:" ",colon:!1},e("isAuth",{valuePropName:"checked",initialValue:0!==p.isAuth})(v.default.createElement(c.default,null,"\u6388\u6743\u9700\u8981\u5ba1\u6838\uff08\u6b64\u8d44\u6e90\u9700\u8981\u901a\u8fc7\u63d0\u4f9b\u65b9\u5ba1\u6838\uff0c\u4f7f\u7528\u65b9\u65b9\u53ef\u4f7f\u7528\uff09"))),v.default.createElement(R,{label:"\u9644\u4ef6\u8bc1\u660e",extra:"\u652f\u6301\u6269\u5c55\u540d\uff1a.rar .zip .doc .docx .pdf .jpg... \uff08\u975e\u5fc5\u586b\u9879\uff09"},e("fileUrl",{})(v.default.createElement(i.default,U,v.default.createElement(u.default,null,v.default.createElement(d.default,{type:"upload"})," \u4e0a\u4f20\u6587\u4ef6")))),v.default.createElement(R,null,v.default.createElement("div",{className:k.default.action},v.default.createElement(u.default,{onClick:this.goBack,className:k.default.marginRight},"\u53d6\u6d88"),w?v.default.createElement(u.default,{type:"primary",className:k.default.marginRight,onClick:this.handleSubmit.bind(this,1)},"\u4fdd\u5b58\u5e76\u9a73\u56de"):v.default.createElement(v.Fragment,null,T&&v.default.createElement(u.default,{type:"primary",className:k.default.marginRight,onClick:this.handleSubmit.bind(this,1)},"\u4fdd\u5b58"),v.default.createElement(u.default,{type:"primary",onClick:this.handleSubmit.bind(this,2)},"\u63d0\u4ea4"))))))}},h=b))||h),U=y.default.create()(F);t.default=U}}]);