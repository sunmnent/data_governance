(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[43],{phg6:function(e,t,a){"use strict";var l=a("g09b"),r=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("T2oS");var u=l(a("W9HT"));a("DZo9");var i=l(a("8z0m"));a("+L6B");var s=l(a("2/Rp"));a("Pwec");var n=l(a("CtXQ"));a("sRBo");var c=l(a("kaz8"));a("miYZ");var o=l(a("tsqr")),d=l(a("p0pE")),f=l(a("2Taf")),m=l(a("vZ4D")),p=l(a("l4Ni")),h=l(a("ujKo")),y=l(a("MhPg"));a("5NDa");var b=l(a("5rEg"));a("OaEy");var v=l(a("2fM7"));a("y8nQ");var g,E,N,D=l(a("Vl3Y")),S=r(a("q1tI")),k=a("MuoO"),R=(l(a("Jt6A")),l(a("Qyje"))),A=a("7DNP"),C=a("ATFn"),w=a("qxfp"),T=l(a("fym6")),U=D.default.Item,V=v.default.Option,F=b.default.TextArea,q=(g=(0,k.connect)(function(e){var t=e.resourceDirectory,a=e.cachedData,l=e.loading;return{resourceDirectory:t,cachedData:a,loading:l}}),g((N=function(e){function t(){var e,a;(0,f.default)(this,t);for(var l=arguments.length,r=new Array(l),u=0;u<l;u++)r[u]=arguments[u];return a=(0,p.default)(this,(e=(0,h.default)(t)).call.apply(e,[this].concat(r))),a.state={value:{}},a.blurTableName=function(e){var t=a.props.form,l=t.setFieldsValue,r=t.getFieldValue,u=t.validateFields;if(r("tableName")){var i=r("tableName").toUpperCase();l({tableName:i}),u(["tableName"])}},a.changeSystem=function(e){var t=a.props.form.setFieldsValue,l=a.props.resourceDirectory.systemList.find(function(t){return t.id===e});t({responsible:l&&l.account&&l.account.username})},a.handleSubmit=function(e){a.props.form.validateFieldsAndScroll(function(t,l){if(!t){l.isAuth=l.isAuth?1:0,l.resourceType="M",l.fileUrl=a.state.value.fileUrl,l.fileName=a.state.value.fileName,delete l.responsible;var r=R.default.parse(a.props.location.search.slice(1)),u=r.id;a.props.dispatch({type:"resourceDirectory/saveResource",payload:(0,d.default)({id:u,submitState:e},l)})}})},a.goBack=function(){a.props.dispatch(A.routerRedux.goBack())},a}return(0,y.default)(t,e),(0,m.default)(t,[{key:"componentDidMount",value:function(){var e=this,t=this.props.resourceDirectory,a=t.systemList,l=t.secondCatagory;a.length||this.props.dispatch({type:"resourceDirectory/getSystemList"}),l.length||this.props.dispatch({type:"resourceDirectory/queurySecondCatagory"});var r=R.default.parse(this.props.location.search.slice(1)),u=r.id;u&&this.props.dispatch({type:"resourceDirectory/getResourceDetail",payload:u}).then(function(t){e.setState({value:t}),e.changeSystem(t.busSystemId)})}},{key:"render",value:function(){var e=this,t=this.props.form.getFieldDecorator,a=this.props.resourceDirectory,l=a.systemList,r=a.secondCatagory,f=!0===this.props.loading.effects["resourceDirectory/getResourceDetail"],m=this.state.value,p=R.default.parse(this.props.location.search.slice(1)),h=p.id,y=p.saveBtn,g="".concat(w.BASE_URL,"/tableModelResource/uploadFile?token=").concat((0,w.TOKEN)());h&&(g+="&resourceId=".concat(h));var E={name:"file",action:g,onRemove:function(t){e.setState({value:(0,d.default)({},e.state.value,{fileUrl:"",fileName:""})})},beforeUpload:function(t){var a=new FormData;return a.append("file",t),fetch(g,{method:"POST",body:a}).then(function(e){return e.json()}).then(function(t){t.success?(e.setState({value:(0,d.default)({},e.state.value,{fileUrl:t.obj.fileUrl,fileName:t.obj.fileName})}),o.default.success("\u6587\u4ef6\u4e0a\u4f20\u6210\u529f")):o.default.error(t.msg)}),!1},fileList:m.fileName?[{uid:"1",name:m.fileName,status:"done",url:"".concat(w.BASE_URL,"/tableModelResource/downloadFile?token=").concat((0,w.TOKEN)(),"&fileUrl=").concat(m.fileUrl,"&fileName=").concat(m.fileName)}]:[]},N=function(e,t,a){t&&!t.match(C.ENGLISH_CHART)&&a("\u8bf7\u8f93\u5165\u4ee5\u82f1\u6587\u5f00\u5934\u7684\u82f1\u6587\u540d"),a()};return S.default.createElement(u.default,{spinning:f},S.default.createElement("h1",{className:T.default.title},h?"\u7f16\u8f91":"\u65b0\u5efa","\u6d88\u606f"),S.default.createElement(D.default,{className:T.default.form},S.default.createElement(U,{label:"\u8d44\u6e90\u540d\u79f0"},t("tableName",{initialValue:m.tableName,rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u8d44\u6e90\u540d\u79f0"},{max:20,message:"\u6700\u591a20\u4e2a\u5b57\u7b26"},{validator:N}]})(S.default.createElement(b.default,{onBlur:this.blurTableName,placeholder:"\u8bf7\u8f93\u5165\u8d44\u6e90\u540d\u79f0"}))),S.default.createElement(U,{label:"\u4e2d\u6587\u63cf\u8ff0"},t("tableNameCn",{initialValue:m.tableNameCn,rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u4e2d\u6587\u63cf\u8ff0"}]})(S.default.createElement(b.default,{placeholder:"\u8bf7\u8f93\u5165\u4e2d\u6587\u63cf\u8ff0"}))),S.default.createElement(U,{label:"\u6e90\u7cfb\u7edf"},t("busSystemId",{initialValue:m.busSystemId||l[0]&&l[0].id,rules:[{required:!0,message:"\u8bf7\u9009\u62e9\u6e90\u7cfb\u7edf"}]})(S.default.createElement(v.default,{placeholder:"\u8bf7\u9009\u62e9\u6e90\u7cfb\u7edf",onChange:this.changeSystem,showSearch:!0,optionFilterProp:"children"},l.map(function(e){return S.default.createElement(V,{value:e.id,key:e.id},e.name)})))),S.default.createElement(U,{label:"\u8d23\u4efb\u4eba"},t("responsible",{initialValue:l[0]&&l[0].account&&l[0].account.username,rules:[{required:!0,message:"\u8bf7\u9009\u62e9\u8d23\u4efb\u4eba"}]})(S.default.createElement(b.default,{disabled:!0}))),S.default.createElement(U,{label:"\u4e3b\u9898"},t("classifyId",{initialValue:m.classifyId,rules:[{required:!0,message:"\u8bf7\u9009\u62e9\u4e3b\u9898"}]})(S.default.createElement(v.default,{placeholder:"\u8bf7\u9009\u62e9\u4e3b\u9898"},r.map(function(e){return S.default.createElement(V,{value:e.id,key:e.id},e.name)})))),S.default.createElement(U,{label:"\u670d\u52a1url"},t("url",{initialValue:m.url,rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u670d\u52a1url"}]})(S.default.createElement(b.default,{placeholder:"\u8bf7\u8f93\u5165\u670d\u52a1url"}))),S.default.createElement(U,{label:"\u5907\u6ce8"},t("tableDesc",{initialValue:m.tableDesc})(S.default.createElement(F,{rows:4,placeholder:"\u8bf7\u8f93\u5165\u5907\u6ce8\u4fe1\u606f"}))),S.default.createElement(U,{label:" ",colon:!1},t("isAuth",{valuePropName:"checked",initialValue:0!==m.isAuth})(S.default.createElement(c.default,null,"\u6388\u6743\u9700\u8981\u5ba1\u6838\uff08\u6b64\u8d44\u6e90\u9700\u8981\u901a\u8fc7\u63d0\u4f9b\u65b9\u5ba1\u6838\uff0c\u4f7f\u7528\u65b9\u65b9\u53ef\u4f7f\u7528\uff09"))),S.default.createElement(U,{label:"\u9644\u4ef6\u8bc1\u660e",extra:"\u652f\u6301\u6269\u5c55\u540d\uff1a.rar .zip .doc .docx .pdf .jpg... \uff08\u975e\u5fc5\u586b\u9879\uff09"},t("fileUrl",{})(S.default.createElement(i.default,E,S.default.createElement(s.default,null,S.default.createElement(n.default,{type:"upload"})," \u4e0a\u4f20\u6587\u4ef6")))),S.default.createElement(U,null,S.default.createElement("div",{className:T.default.action},S.default.createElement(s.default,{onClick:this.goBack,className:T.default.marginRight},"\u53d6\u6d88"),"0"!==y&&S.default.createElement(s.default,{type:"primary",className:T.default.marginRight,onClick:this.handleSubmit.bind(this,1)},"\u4fdd\u5b58"),S.default.createElement(s.default,{type:"primary",onClick:this.handleSubmit.bind(this,2)},"\u63d0\u4ea4")))))}}]),t}(S.Component),E=N))||E),B=D.default.create()(q);t.default=B}}]);